<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fable Tactics – Party Selector</title>
<style>
  :root { --panel:#171922; --muted:#9aa3b2; --accent:#7fe6a2; }
  * { box-sizing:border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
  body { margin:0; background:linear-gradient(180deg,#0b0c0f,#12131a); color:white; }
  header { padding:16px 20px; border-bottom:1px solid #222633; background:#12141c; position:sticky; top:0; z-index:5; }
  header h1 { margin:0; font-size:18px; letter-spacing:.4px; }
  main { max-width:1100px; margin:0 auto; padding:20px; display:grid; gap:16px; grid-template-columns: 1fr 1fr; }
  .panel { background:var(--panel); border:1px solid #24283a; border-radius:12px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.25); }
  h2 { margin:0 0 10px; font-size:14px; color:var(--muted); text-transform:uppercase; letter-spacing:.12em; }
  .small { font-size:12px; color:var(--muted); }
  .row { display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end; }
  .col { display:flex; flex-direction:column; gap:6px; }
  label { font-size:12px; color:var(--muted); }
  input[type="text"], input[type="number"], select {
    padding:10px 12px; background:#0f1420; color:#fff; border:1px solid #2a3246; border-radius:10px; min-width:120px;
  }
  input[type="number"] { width:92px; }
  button { background:#1c2636; color:white; border:1px solid #2b3144; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; }
  button:hover { border-color:#3a425d; }
  button.ghost { background:transparent; border-color:#2b3144; }
  button.primary { background:#1e2e3d; border-color:#405a62; }
  button.warn { background:#3a1d1d; border-color:#6c3737; }
  .lists { display:grid; gap:16px; grid-template-columns: 1fr 1fr; }
  .unitCard {
    display:grid; grid-template-columns: 56px 1fr auto; gap:10px; align-items:center;
    padding:10px; margin:6px 0; background:#11131a; border:1px solid #1f2330; border-radius:10px;
  }
  .sprite { width:56px; height:56px; border-radius:8px; background:#0f1420; background-size:cover; background-position:center; border:1px solid #2b3144; }
  .name { font-weight:700; }
  .meta { font-size:12px; color:var(--muted); }
  .pill { font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid #2b3144; background:#111520; opacity:.9; margin-left:6px; }
  .footer { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .notice { font-size:12px; color:#cfe9d9; }
  .sep { height:1px; background:#222634; margin:8px 0; }
</style>
</head>
<body>
  <header><h1>Fable Tactics – Party Selector</h1></header>
  <main>
    <section class="panel">
      <h2>Build Unit</h2>
      <div class="small">Pick a class, edit name (optional), choose a team, and (optionally) set a starting X/Y. Click <b>Add</b> to queue it.</div>
      <div class="sep"></div>
      <div class="row">
        <div class="col">
          <label>Class</label>
          <select id="classSel"></select>
        </div>
        <div class="col">
          <label>Name (optional)</label>
          <input id="nameInput" type="text" placeholder="auto from class">
        </div>
        <div class="col">
          <label>Team</label>
          <select id="teamSel">
            <option value="ally">Allies</option>
            <option value="enemy">Enemies</option>
          </select>
        </div>
        <div class="col">
          <label>Start X (optional)</label>
          <input id="xInput" type="number" min="0" value="">
        </div>
        <div class="col">
          <label>Start Y (optional)</label>
          <input id="yInput" type="number" min="0" value="">
        </div>
        <div class="col">
          <button id="addBtn" class="primary">Add</button>
        </div>
      </div>
      <div class="sep"></div>
      <div class="small">Sprite preview</div>
      <div id="preview" class="sprite" style="width:96px; height:96px;"></div>
    </section>

    <section class="panel">
      <h2>Settings (Optional)</h2>
      <div class="row">
        <div class="col">
          <label>Default Grid Width (for guidance)</label>
          <input id="gridW" type="number" min="4" max="16" value="8">
        </div>
        <div class="col">
          <label>Default Grid Height</label>
          <input id="gridH" type="number" min="3" max="12" value="6">
        </div>
      </div>
      <div class="sep"></div>
      <div class="footer">
        <button id="saveBtn" class="primary">Save to Browser</button>
        <button id="loadBtn" class="ghost">Load Existing</button>
        <button id="clearBtn" class="warn">Clear All</button>
        <span class="notice">Saved as <code>ft_setup</code> in localStorage. Use “Preset: From Selector” in the game.</span>
      </div>
    </section>

    <section class="panel" style="grid-column: 1 / -1;">
      <h2>Queued Units</h2>
      <div class="small">Tip: If you set X/Y outside your game’s grid, the main game will clamp or auto-place them.</div>
      <div class="sep"></div>
      <div class="lists">
        <div>
          <div class="small">Allies</div>
          <div id="allyList"></div>
        </div>
        <div>
          <div class="small">Enemies</div>
          <div id="enemyList"></div>
        </div>
      </div>
    </section>
  </main>

<script>
/* Keep this in sync with the game's UnitTemplates keys */
const CLASSES = [
  "Knight","Fighter","Rogue","Archer","Bruiser","Imp",
  "Cleric","Bard","Druid","Enchanter","Shaman"
];

/* Sprite map (use your real paths if you have them) */
const SPRITES = {
  Knight: "https://via.placeholder.com/128x128?text=Knight",
  Fighter:"https://via.placeholder.com/128x128?text=Fighter",
  Rogue:  "https://via.placeholder.com/128x128?text=Rogue",
  Archer: "https://via.placeholder.com/128x128?text=Archer",
  Bruiser:"https://via.placeholder.com/128x128?text=Bruiser",
  Imp:    "https://via.placeholder.com/128x128?text=Imp",
  Cleric: "https://via.placeholder.com/128x128?text=Cleric",
  Bard:   "https://via.placeholder.com/128x128?text=Bard",
  Druid:  "https://via.placeholder.com/128x128?text=Druid",
  Enchanter:"https://via.placeholder.com/128x128?text=Enchanter",
  Shaman: "https://via.placeholder.com/128x128?text=Shaman"
};

/* Reasonable default names if user leaves blank */
const DEFAULT_NAMES = {
  Knight: "Tallis (Knight)",
  Fighter:"Fighter",
  Rogue:"Rogue",
  Archer:"Clover (Archer)",
  Bruiser:"Goblin Bruiser",
  Imp: "Woad Imp",
  Cleric:"Cleric",
  Bard:"Bard",
  Druid:"Druid",
  Enchanter:"Enchanter",
  Shaman:"Shaman"
};

const state = {
  gridW: 8,
  gridH: 6,
  allies: [],
  enemies: []
};

/* DOM */
const classSel = document.getElementById('classSel');
const nameInput = document.getElementById('nameInput');
const teamSel = document.getElementById('teamSel');
const xInput = document.getElementById('xInput');
const yInput = document.getElementById('yInput');
const addBtn = document.getElementById('addBtn');
const preview = document.getElementById('preview');

const gridW = document.getElementById('gridW');
const gridH = document.getElementById('gridH');
const saveBtn = document.getElementById('saveBtn');
const loadBtn = document.getElementById('loadBtn');
const clearBtn = document.getElementById('clearBtn');

const allyList = document.getElementById('allyList');
const enemyList = document.getElementById('enemyList');

/* init */
(function init(){
  classSel.innerHTML = CLASSES.map(c=>`<option value="${c}">${c}</option>`).join('');
  classSel.value = "Knight";
  updatePreview();
  gridW.value = state.gridW; gridH.value = state.gridH;
  renderLists();
})();

function updatePreview(){
  const c = classSel.value;
  preview.style.backgroundImage = `url("${SPRITES[c]||''}")`;
}
classSel.addEventListener('change', updatePreview);

/* Add unit */
addBtn.onclick = ()=>{
  const tpl = classSel.value;
  const name = (nameInput.value||"").trim() || DEFAULT_NAMES[tpl] || tpl;
  const team = teamSel.value;
  let pos = null;

  const x = xInput.value === "" ? null : Number(xInput.value);
  const y = yInput.value === "" ? null : Number(yInput.value);
  if(Number.isFinite(x) && Number.isFinite(y) && x>=0 && y>=0) pos = {x,y};

  const unit = { tpl, name, pos };
  if(team === "ally") state.allies.push(unit); else state.enemies.push(unit);

  // clear name/x/y for faster repeated entry
  nameInput.value = ""; xInput.value=""; yInput.value="";
  renderLists();
};

/* Render queues */
function renderLists(){
  allyList.innerHTML = state.allies.map((u,i)=>cardHTML(u,"ally",i)).join('') || `<div class="small">No allies yet.</div>`;
  enemyList.innerHTML = state.enemies.map((u,i)=>cardHTML(u,"enemy",i)).join('') || `<div class="small">No enemies yet.</div>`;

  // wire delete buttons
  document.querySelectorAll('[data-del]').forEach(btn=>{
    btn.onclick = ()=>{
      const { team, idx } = btn.dataset;
      const i = Number(idx);
      if(team==="ally") state.allies.splice(i,1); else state.enemies.splice(i,1);
      renderLists();
    };
  });
}

function cardHTML(u,team,idx){
  const pos = u.pos ? ` • POS (${u.pos.x},${u.pos.y})` : ' • POS auto';
  return `
    <div class="unitCard">
      <div class="sprite" style="background-image:url('${SPRITES[u.tpl]||""}')"></div>
      <div>
        <div class="name">${u.name}</div>
        <div class="meta">${u.tpl}<span class="pill">${team.toUpperCase()}</span>${pos}</div>
      </div>
      <div><button class="ghost" data-del data-team="${team}" data-idx="${idx}">Remove</button></div>
    </div>
  `;
}

/* Save / Load / Clear */
saveBtn.onclick = ()=>{
  state.gridW = clampInt(gridW.value, 8, 4, 16);
  state.gridH = clampInt(gridH.value, 6, 3, 12);

  const payload = {
    grid: { w: state.gridW, h: state.gridH }, // informational only; main game ignores/overrides if different
    allies: state.allies,
    enemies: state.enemies
  };
  localStorage.setItem('ft_setup', JSON.stringify(payload));
  alert('Saved party to localStorage as "ft_setup". In the main game, click “Preset: From Selector”.');
};

loadBtn.onclick = ()=>{
  const raw = localStorage.getItem('ft_setup');
  if(!raw){ alert('No saved ft_setup found.'); return; }
  try{
    const data = JSON.parse(raw);
    state.allies = Array.isArray(data.allies) ? data.allies : [];
    state.enemies = Array.isArray(data.enemies) ? data.enemies : [];
    if(data.grid){ gridW.value = data.grid.w ?? gridW.value; gridH.value = data.grid.h ?? gridH.value; }
    renderLists();
  }catch(e){
    alert('Could not parse ft_setup.');
  }
};

clearBtn.onclick = ()=>{
  if(!confirm('Clear allies, enemies, and remove ft_setup from localStorage?')) return;
  state.allies = [];
  state.enemies = [];
  localStorage.removeItem('ft_setup');
  renderLists();
};

/* helpers */
function clampInt(v, def, min, max){
  const n = Number(v);
  if(!Number.isFinite(n)) return def;
  return Math.max(min, Math.min(max, Math.round(n)));
}
</script>
</body>
</html>
