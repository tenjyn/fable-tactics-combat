<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fable Tactics – Party Selector</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Unbounded:wght@600&display=swap');
    :root {
      --bg:#080910;
      --panel:#161927;
      --panel-border:#24283a;
      --accent:#7fe6a2;
      --muted:#9aa3b2;
    }
    * { box-sizing:border-box; font-family:'Outfit', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    body {
      margin:0;
      min-height:100vh;
      background:
        radial-gradient(circle at 16% 18%, rgba(127,230,162,.12) 0%, transparent 45%),
        radial-gradient(circle at 85% 12%, rgba(94,129,244,.14) 0%, transparent 50%),
        linear-gradient(180deg,#0a0d16,#0f1320 55%,#10121c 100%);
      color:white;
      position:relative;
      overflow-x:hidden;
    }
    body::before {
      content:"";
      position:fixed;
      inset:-120px;
      background-image:radial-gradient(rgba(255,255,255,.12) 0 1px, transparent 1px);
      background-size:64px 64px;
      opacity:.4;
      mix-blend-mode:screen;
      pointer-events:none;
      z-index:-2;
    }
    header {
      padding:18px 24px;
      border-bottom:1px solid rgba(94,129,244,.24);
      background:linear-gradient(135deg, rgba(18,24,44,.94), rgba(12,15,26,.92));
      position:sticky;
      top:0;
      z-index:5;
      backdrop-filter:blur(12px);
    }
    header h1 {
      margin:0;
      font-family:'Unbounded','Outfit',system-ui;
      font-size:18px;
      letter-spacing:.55px;
      text-transform:uppercase;
    }
    main {
      max-width:1100px;
      margin:0 auto;
      padding:26px 22px 48px;
      display:grid;
      gap:18px;
      grid-template-columns: 1fr 1fr;
      position:relative;
    }
    main::before {
      content:"";
      position:absolute;
      inset:0;
      border-radius:26px;
      background:radial-gradient(circle at 12% 6%, rgba(94,129,244,.22), transparent 60%),
                 radial-gradient(circle at 88% 18%, rgba(126,230,162,.16), transparent 60%);
      opacity:.55;
      z-index:-1;
    }
    .panel {
      background:linear-gradient(180deg, rgba(22,25,39,.92), rgba(12,14,24,.94));
      border:1px solid var(--panel-border);
      border-radius:14px;
      padding:18px;
      box-shadow:0 18px 36px rgba(0,0,0,.32);
      position:relative;
      overflow:hidden;
    }
    .panel::before {
      content:"";
      position:absolute;
      inset:1px;
      border-radius:12px;
      background:linear-gradient(160deg, rgba(255,255,255,.045), rgba(15,18,32,.8));
      z-index:-1;
    }
    .panel::after {
      content:"";
      position:absolute;
      inset:-45% -35% auto;
      height:70%;
      background:radial-gradient(circle, rgba(94,129,244,.1) 0%, transparent 75%);
      opacity:0;
      transition:opacity .35s ease;
      pointer-events:none;
    }
    .panel:hover::after { opacity:1; }
    h2 {
      margin:0 0 12px;
      font-size:13px;
      font-weight:600;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:var(--muted);
    }
    h2::after {
      content:"";
      display:block;
      margin-top:8px;
      width:48px;
      height:2px;
      border-radius:999px;
      background:linear-gradient(90deg, rgba(94,129,244,.6), transparent);
    }
    .small { font-size:12px; color:var(--muted); }
    .sep { height:1px; background:rgba(52,58,86,.6); margin:12px 0; border-radius:999px; }
    .row { display:flex; gap:14px; flex-wrap:wrap; align-items:flex-end; }
    .col { display:flex; flex-direction:column; gap:6px; min-width:140px; }
    label { font-size:12px; color:var(--muted); }
    input[type="text"], input[type="number"], select {
      padding:8px 10px;
      background:#0f1420;
      color:#fff;
      border:1px solid rgba(42,50,70,.85);
      border-radius:10px;
      box-shadow:0 8px 16px rgba(0,0,0,.25) inset;
    }
    input[type="number"] { width:92px; }
    input[type="range"] { accent-color:var(--accent); }
    button {
      background:rgba(26,36,54,.92);
      color:white;
      border:1px solid rgba(48,58,92,.9);
      padding:10px 16px;
      border-radius:11px;
      cursor:pointer;
      font-weight:600;
      letter-spacing:.02em;
      transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease;
      position:relative;
      overflow:hidden;
    }
    button::after {
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(135deg, rgba(94,129,244,.18), transparent 60%);
      opacity:0;
      transition:opacity .2s ease;
      pointer-events:none;
    }
    button:hover {
      border-color:rgba(114,153,255,.9);
      transform:translateY(-1px);
      box-shadow:0 10px 18px rgba(14,18,34,.35);
    }
    button:hover::after { opacity:.55; }
    button.primary {
      background:linear-gradient(135deg, rgba(33,58,84,.95), rgba(41,94,114,.92));
      border-color:rgba(86,190,180,.85);
      box-shadow:0 8px 18px rgba(12,34,42,.45);
    }
    button.primary::after { background:linear-gradient(135deg, rgba(127,230,162,.3), transparent 65%); }
    button.ghost { background:rgba(18,24,37,.75); border-color:rgba(50,60,92,.65); }
    button.warn { background:linear-gradient(135deg, rgba(90,33,33,.92), rgba(56,18,24,.92)); border-color:rgba(177,72,72,.8); }
    button:disabled { opacity:.6; cursor:not-allowed; box-shadow:none; transform:none; }
    button:disabled::after { display:none; }
    .footer { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .notice { font-size:12px; color:#cfe9d9; opacity:.85; }
    code { background:rgba(18,24,37,.8); padding:2px 6px; border-radius:6px; border:1px solid rgba(52,64,92,.6); }
    .lists { display:grid; gap:18px; grid-template-columns: 1fr 1fr; }
    #allyList, #enemyList { display:flex; flex-direction:column; gap:10px; }
    .unitCard {
      position:relative;
      display:grid;
      grid-template-columns: 64px 1fr auto;
      gap:14px;
      align-items:center;
      padding:12px 14px;
      background:linear-gradient(120deg, rgba(15,18,32,.85), rgba(17,23,41,.92));
      border:1px solid rgba(58,66,104,.7);
      border-radius:12px;
      box-shadow:0 12px 24px rgba(4,6,12,.45);
    }
    .unitCard::after {
      content:"";
      position:absolute;
      inset:auto 18px -6px;
      height:1px;
      border-radius:999px;
      background:linear-gradient(90deg, rgba(127,230,162,.4), transparent 70%);
      opacity:.3;
      pointer-events:none;
    }
    .sprite {
      width:64px;
      height:64px;
      border-radius:12px;
      background:#0f1420;
      background-size:cover;
      background-position:center;
      border:1px solid rgba(72,92,140,.6);
      box-shadow:0 10px 20px rgba(0,0,0,.35);
    }
    #preview { width:96px; height:96px; border-radius:16px; border:1px solid rgba(72,92,140,.6); box-shadow:0 14px 28px rgba(0,0,0,.4); background-size:cover; background-position:center; margin-top:10px; }
    .name { font-weight:700; font-size:14px; }
    .meta { font-size:12px; color:var(--muted); display:flex; gap:6px; flex-wrap:wrap; align-items:center; }
    .meta .metaClass { color:#e0e8ff; font-weight:500; }
    .meta .pos { padding:2px 6px; border-radius:6px; background:rgba(24,32,52,.8); border:1px solid rgba(44,60,92,.6); font-size:11px; letter-spacing:.03em; }
    .pill { font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid rgba(76,86,120,.8); background:rgba(16,23,41,.6); }
    .classInfo {
      margin-top:12px;
      padding:12px;
      border-radius:10px;
      background:rgba(15,20,32,.78);
      border:1px solid rgba(60,72,110,.7);
      box-shadow:0 8px 16px rgba(0,0,0,.25) inset;
      line-height:1.6;
    }
    .classInfo strong { color:#e5f0ff; }
  </style>
</head>
<body>
  <header><h1>Fable Tactics – Party Selector</h1></header>
  <main>
    <section class="panel">
      <h2>Build Unit</h2>
      <div class="small">Pick a class, edit name (optional), choose a team, and (optionally) set a starting X/Y. Click <b>Add</b> to queue it.</div>
      <div class="sep"></div>
      <div class="row">
        <div class="col">
          <label>Class</label>
          <select id="classSel"></select>
        </div>
        <div class="col">
          <label>Name (optional)</label>
          <input id="nameInput" type="text" placeholder="auto from class">
        </div>
        <div class="col">
          <label>Team</label>
          <select id="teamSel">
            <option value="ally">Allies</option>
            <option value="enemy">Enemies</option>
          </select>
        </div>
        <div class="col">
          <label>Start X (optional)</label>
          <input id="xInput" type="number" min="0" value="">
        </div>
        <div class="col">
          <label>Start Y (optional)</label>
          <input id="yInput" type="number" min="0" value="">
        </div>
        <div class="col">
          <button id="addBtn" class="primary">Add</button>
        </div>
      </div>
      <div class="sep"></div>
      <div class="small">Sprite preview</div>
      <div id="preview" class="sprite"></div>
      <div id="classInfo" class="classInfo small"></div>
    </section>

    <section class="panel">
      <h2>Settings (Optional)</h2>
      <div class="row">
        <div class="col">
          <label>Default Grid Width (for guidance)</label>
          <input id="gridW" type="number" min="4" max="16" value="8">
        </div>
        <div class="col">
          <label>Default Grid Height</label>
          <input id="gridH" type="number" min="3" max="12" value="6">
        </div>
      </div>
      <div class="sep"></div>
      <div class="footer">
        <button id="saveBtn" class="primary">Save to Browser</button>
        <button id="loadBtn" class="ghost">Load Existing</button>
        <button id="clearBtn" class="warn">Clear All</button>
        <span class="notice">Saved as <code>ft_setup</code> in localStorage. Use “Preset: From Selector” in the game.</span>
      </div>
    </section>

    <section class="panel" style="grid-column: 1 / -1;">
      <h2>Queued Units</h2>
      <div class="small">Tip: If you set X/Y outside your game’s grid, the main game will clamp or auto-place them.</div>
      <div class="sep"></div>
      <div class="lists">
        <div>
          <div class="small">Allies</div>
          <div id="allyList"></div>
        </div>
        <div>
          <div class="small">Enemies</div>
          <div id="enemyList"></div>
        </div>
      </div>
    </section>
  </main>

<script src="class-data.js"></script>
<script>
const CLASS_ENTRIES = window.FABLE_DATA.CLASS_DATABASE;
const CLASS_NAMES = CLASS_ENTRIES.map(entry=>entry.name);

/* Sprite map (use your real paths if you have them) */
const SPRITES = (()=>{
  const spriteSvg = (label, primary, accent, glyph)=>{
    const id = label.replace(/[^a-z0-9]/gi,'');
    const safeGlyph = glyph || label[0] || '?';
    const svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128">
      <defs>
        <linearGradient id="grad${id}" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="${primary}"/>
          <stop offset="100%" stop-color="${accent}"/>
        </linearGradient>
        <radialGradient id="glow${id}" cx="0.3" cy="0.2" r="0.85">
          <stop offset="0%" stop-color="rgba(255,255,255,0.45)"/>
          <stop offset="60%" stop-color="rgba(255,255,255,0.1)"/>
          <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
        </radialGradient>
      </defs>
      <rect width="128" height="128" rx="22" fill="url(#grad${id})"/>
      <rect width="128" height="128" rx="22" fill="url(#glow${id})" opacity="0.55"/>
      <circle cx="108" cy="28" r="18" fill="rgba(255,255,255,0.16)"/>
      <circle cx="32" cy="18" r="12" fill="rgba(0,0,0,0.18)"/>
      <text x="64" y="78" text-anchor="middle" font-family="'Outfit', 'Segoe UI', sans-serif" font-size="56" fill="#ffffff" opacity="0.92">${safeGlyph}</text>
      <text x="64" y="112" text-anchor="middle" font-family="'Outfit', 'Segoe UI', sans-serif" font-size="18" fill="#f8fbff" letter-spacing="1">${label}</text>
    </svg>`;
    return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
  };
  const palettes = [
    ['#3b6bff','#91b4ff'],
    ['#f97316','#facc15'],
    ['#14b8a6','#60a5fa'],
    ['#f472b6','#c084fc'],
    ['#22c55e','#a3e635'],
    ['#f87171','#fb7185'],
    ['#0ea5e9','#38bdf8'],
    ['#ef4444','#f97316'],
    ['#a855f7','#f0abfc'],
    ['#eab308','#f97316']
  ];
  const glyphs = window.FABLE_DATA.GLYPH_OVERRIDES || {};
  return Object.fromEntries(CLASS_NAMES.map((label, idx)=>{
    const [primary, accent] = palettes[idx % palettes.length];
    const glyph = glyphs[label] || label[0] || '?';
    return [label, spriteSvg(label, primary, accent, glyph)];
  }));
})();

function defaultNameFor(cls){
  return window.FABLE_DATA.defaultNameFor(cls);
}

const state = {
  gridW: 8,
  gridH: 6,
  allies: [],
  enemies: []
};

/* DOM */
const classSel = document.getElementById('classSel');
const nameInput = document.getElementById('nameInput');
const teamSel = document.getElementById('teamSel');
const xInput = document.getElementById('xInput');
const yInput = document.getElementById('yInput');
const addBtn = document.getElementById('addBtn');
const preview = document.getElementById('preview');
const classInfo = document.getElementById('classInfo');

const gridW = document.getElementById('gridW');
const gridH = document.getElementById('gridH');
const saveBtn = document.getElementById('saveBtn');
const loadBtn = document.getElementById('loadBtn');
const clearBtn = document.getElementById('clearBtn');

const allyList = document.getElementById('allyList');
const enemyList = document.getElementById('enemyList');

/* init */
(function init(){
  classSel.innerHTML = CLASS_NAMES.map(c=>`<option value="${c}">${c}</option>`).join('');
  classSel.value = CLASS_NAMES[0] || "Knight";
  updatePreview();
  gridW.value = state.gridW; gridH.value = state.gridH;
  renderLists();
})();

function updatePreview(){
  const c = classSel.value;
  preview.style.backgroundImage = `url("${SPRITES[c]||''}")`;
  if(classInfo){
    const entry = CLASS_ENTRIES.find(e=>e.name===c);
    if(entry){
      const core = entry.stats || {};
      const attune = entry.attunement || {};
      const res = entry.resources || {};
      const skills = (entry.startingSkills||[]).join(', ');
      classInfo.innerHTML = `
        <div><strong>Core:</strong> STR ${core.STR} • DEX ${core.DEX} • CON ${core.CON} • INT ${core.INT} • WIS ${core.WIS} • CHA ${core.CHA}</div>
        <div><strong>Attune:</strong> FAE ${attune.FAE ?? 0} • DREAM ${attune.DREAM ?? 0}</div>
        <div><strong>Vitals:</strong> HP ${res.HP ?? '-'} • EP ${res.EP ?? '-'} • AP ${res.AP ?? '-'} • MOV ${res.MOV ?? '-'}</div>
        <div><strong>Skills:</strong> ${skills}</div>
      `;
    } else {
      classInfo.textContent = '';
    }
  }
}
classSel.addEventListener('change', updatePreview);

/* Add unit */
addBtn.onclick = ()=>{
  const tpl = classSel.value;
  const name = (nameInput.value||"").trim() || defaultNameFor(tpl);
  const team = teamSel.value;
  let pos = null;

  const x = xInput.value === "" ? null : Number(xInput.value);
  const y = yInput.value === "" ? null : Number(yInput.value);
  if(Number.isFinite(x) && Number.isFinite(y) && x>=0 && y>=0) pos = {x,y};

  const unit = { tpl, name, pos };
  if(team === "ally") state.allies.push(unit); else state.enemies.push(unit);

  // clear name/x/y for faster repeated entry
  nameInput.value = ""; xInput.value=""; yInput.value="";
  renderLists();
};

/* Render queues */
function renderLists(){
  allyList.innerHTML = state.allies.map((u,i)=>cardHTML(u,"ally",i)).join('') || `<div class="small">No allies yet.</div>`;
  enemyList.innerHTML = state.enemies.map((u,i)=>cardHTML(u,"enemy",i)).join('') || `<div class="small">No enemies yet.</div>`;

  // wire delete buttons
  document.querySelectorAll('[data-del]').forEach(btn=>{
    btn.onclick = ()=>{
      const { team, idx } = btn.dataset;
      const i = Number(idx);
      if(team==="ally") state.allies.splice(i,1); else state.enemies.splice(i,1);
      renderLists();
    };
  });
}

function cardHTML(u,team,idx){
  const posLabel = u.pos ? `(${u.pos.x},${u.pos.y})` : 'auto';
  return `
    <div class="unitCard">
      <div class="sprite" style="background-image:url('${SPRITES[u.tpl]||""}')"></div>
      <div>
        <div class="name">${u.name}</div>
        <div class="meta"><span class="metaClass">${u.tpl}</span><span class="pill">${team.toUpperCase()}</span><span class="pos">POS ${posLabel}</span></div>
      </div>
      <div><button class="ghost" data-del data-team="${team}" data-idx="${idx}">Remove</button></div>
    </div>
  `;
}

/* Save / Load / Clear */
saveBtn.onclick = ()=>{
  state.gridW = clampInt(gridW.value, 8, 4, 16);
  state.gridH = clampInt(gridH.value, 6, 3, 12);

  const payload = {
    grid: { w: state.gridW, h: state.gridH }, // informational only; main game ignores/overrides if different
    allies: state.allies,
    enemies: state.enemies
  };
  localStorage.setItem('ft_setup', JSON.stringify(payload));
  alert('Saved party to localStorage as "ft_setup". In the main game, click “Preset: From Selector”.');
};

loadBtn.onclick = ()=>{
  const raw = localStorage.getItem('ft_setup');
  if(!raw){ alert('No saved ft_setup found.'); return; }
  try{
    const data = JSON.parse(raw);
    state.allies = Array.isArray(data.allies) ? data.allies : [];
    state.enemies = Array.isArray(data.enemies) ? data.enemies : [];
    if(data.grid){ gridW.value = data.grid.w ?? gridW.value; gridH.value = data.grid.h ?? gridH.value; }
    renderLists();
  }catch(e){
    alert('Could not parse ft_setup.');
  }
};

clearBtn.onclick = ()=>{
  if(!confirm('Clear allies, enemies, and remove ft_setup from localStorage?')) return;
  state.allies = [];
  state.enemies = [];
  localStorage.removeItem('ft_setup');
  renderLists();
};

/* helpers */
function clampInt(v, def, min, max){
  const n = Number(v);
  if(!Number.isFinite(n)) return def;
  return Math.max(min, Math.min(max, Math.round(n)));
}
</script>
</body>
</html>
